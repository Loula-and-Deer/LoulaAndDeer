  <script>
class SearchResult {
    constructor(DOM, title, vendor, price, id) {
        this.DOM = DOM;
        this.title = title;
        this.vendor = vendor;
        this.price = Number(price);
        this.id = id;
        this.quantity = DOM.find(".buttons").find(".search-qty").val();
    }
}

// function setCookie(cname, cvalue, exdays) {
//     var d = new Date();
//     d.setTime(d.getTime() + (exdays*24*60*60*1000));
//     var expires = "expires="+ d.toUTCString();
//     document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
// }

// function getCookie(cname) {
//     var name = cname + "=";
//     var decodedCookie = decodeURIComponent(document.cookie);
//     var ca = decodedCookie.split(';');
//     for(var i = 0; i <ca.length; i++) {
//         var c = ca[i];
//         while (c.charAt(0) == ' ') {
//             c = c.substring(1);
//         }
//         if (c.indexOf(name) == 0) {
//             return c.substring(name.length, c.length);
//         }
//     }
//     return "";
// }

// function checkCookie() {
//     var listStyle = getCookie("search-ls");
//     if (user != "") {
//         return listStyle;
//     } else {
//         setCookie("search-ls", "list", 365);
//     }
// }

(function($) {
  $(function() {
    var minProductPrice = 0;
    var maxProductPrice = 0;
    var products = [];
    var vendors = new Set();
    var i = 0;

    //Change vendor H3
    $("#vendor-filter > h3").text("LOADING...");
    
    //Initialise search result array
    $(".results").each(function() {
      
      //Increment is here to match HTML ID's
      i++;
      var searchResult = $(this).find(".search-result");
      var prod_id =  $(searchResult).attr("product_id");
      var title = $(searchResult).find(".product-title").attr("productTitle");
      var vendor = $(searchResult).find(".product-vendor").attr("productVendor");
      var price = $(searchResult).find(".product-price").attr("productPrice");
      products[i] = new SearchResult($(this), title, vendor, price, prod_id);
      $(searchResult).attr("index", i);
    });

    //Set up page
    if(i > 0){
      minProductPrice = products[1].price;
    }
    
    //Loops over each product
    products.forEach(function(e) {
      //If cheapest product set min price
      if (e.price < minProductPrice) {
        minProductPrice = e.price;
      }
      
      //If most expensive product set max price
      if (e.price > maxProductPrice) {
        maxProductPrice = e.price;
      }

      //Adds all vendors to the vendors set
      vendors.add(e.vendor)
    });
    
    //Create DOM elements for filter list
    createVendorFilterList(vendors);
      
    //Added 1000 (Â£1) because sometimes Edge can't snap to the max price.
    $("#maxPriceInput").attr("min", minProductPrice);
    $("#maxPriceInput").attr("max", (maxProductPrice + 100));
    $("#maxPriceInput").attr("value", maxProductPrice);
    
    $("#maxPriceText").text(Shopify.formatMoney(maxProductPrice, "{{ shop.money_with_currency_format  }}"
                                               ));
    //Revertes text from "Loading"
    $("#vendor-filter > h3:first").text("Brand");
    
    /*=======================
      ||  Lisetner Events  ||
      =======================*/
    $(document).on('input', '#maxPriceInput', function() {
      $('#maxPriceText').text(Shopify.formatMoney($(this).val(), "{{ shop.money_with_currency_format  }}"
                                                 ));
    });

    $("#maxPriceInput").change(function() {
      filterProducts($(this).val());
    });
    
    //Filter results when a new vendor/brand is selected
    $('input[class*="vendorCheckbox"]').change(function() {
      filterProducts($("#maxPriceInput").val());
    });

    //Open filter menu mobile bind
    $("#open-filter-button").bind( "tap", openFilterMenu );
    
    //Open filter menu deskop bind
    $("#open-filter-button").bind( "click", openFilterMenu );
    
    //Close filter menu mobile bind
    $("#close-filter-button").bind( "tap", closeFilterMenu );
    
    //Close filter menu deskop bind
    $("#close-filter-button").bind( "click", closeFilterMenu );
    
    /*=================
      ||  Functions  ||
      =================*/
    function openFilterMenu( event ){
      $('#filter-column').css("display", "block");
      $('.filter-underlay').css("display", "block");
    }
    
    function closeFilterMenu( event ){
      $('#filter-column').css("display", "none");
      $('.filter-underlay').css("display", "none");
    }
    
    function createVendorFilterList(vendorList) {
      vendorList.forEach(function(e) {
        var li = "<li>";
        li += '<input class="vendorCheckbox" type="checkbox" vendor="' + e + '" id="' + e + '_id">' ;
        li += '<label class="checkbox-background fl" for="' + e + '_id"></label>';
        li += '<p style="line-height: initial; display: inline-block;">' + e + '</p>';
        li += '</li>';
        $("#vendor-filter").append(li);
      });
    }
    
    function filterProducts(maxPrice) {
      var filterVendor = new Set();
      var amtOfProductsShown = 0;
      
      $('input[class*="vendorCheckbox"]').each(function() {
        if($(this).is(':checked')){
          filterVendor.add($(this).attr("vendor"));
        }
      });
      
      //Show all within price range if vendor filter is cleared
      if (filterVendor.size <= 0) {
        products.forEach(function(e) {
          if (e.price > maxPrice) {
            e.DOM.hide(0);
          } else {
            amtOfProductsShown++;
            if ($(e.DOM).is(":hidden")) {
              e.DOM.fadeIn(0);
            }
          }
        });
        $("#search-conditions").text("Showing " + amtOfProductsShown + " filtered results.")
        return;
      }
      
      vendorsSetAsArray = Array.from(filterVendor);
      products.forEach(function(e) {
        if ( jQuery.inArray(e.vendor, vendorsSetAsArray) != -1) {
          if (e.price <= maxPrice) {
            amtOfProductsShown++;
            if ($(e.DOM).is(":hidden")) {
              e.DOM.fadeIn(0);
            }  
          } else {
            e.DOM.hide(0);
          }
        } else {
          e.DOM.hide(0);
        }
      });
      $("#search-conditions").text("Showing " + amtOfProductsShown + " filtered results.")
    }
  });
})(jQuery);

</script>